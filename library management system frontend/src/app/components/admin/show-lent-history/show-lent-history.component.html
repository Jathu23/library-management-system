<div class="table-responsive mt-4">
  <table class="table table-bordered table-striped table-hover shadow">
    <thead class="table-dark">
      <tr>
        <th>ID</th>
        <th>Username</th>
        <th>Book Title</th>
        <th>Lent Date</th>
        <th>Due Date</th>
        <th>Return Date</th>
        <th>Status</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <!-- Main Rows -->
      <ng-container *ngFor="let history of lenthistorys">
        <tr>
          <td>{{ history.id }}</td>
          <td>{{ history.userName }}</td>
          <td>{{ history.bookTitle }}</td>
          <td>{{ history.lentDate | date: 'medium' }}</td>
          <td>{{ history.dueDate | date: 'medium' }}</td>
          <td>
            {{ history.returnDate ? (history.returnDate | date: 'medium') : 'Not Returned' }}
          </td>
          <td> 
            <progress *ngIf="history.statusValue != 0" value="{{history.statusValue}}" max="{{history.maxValue}}"></progress>
            {{ history.status }}
          </td>
          <td>
            <button (click)="toggleRow(history.id)" class="btn  btn-sm buttons">
              {{ expandedElementId === history.id ? 'Hide' : 'View' }}
            </button>
          </td>
        </tr>

        <!-- Expanded Row -->
        <tr *ngIf="expandedElementId === history.id">
          <td colspan="8">
            <div class="expanded-content">
              <h4>Detailed Information</h4>
              <table class="table table-bordered">
                <tr>
                  <td><strong>User ID:</strong></td>
                  <td>{{ history.userId }}</td>
                </tr>
                <tr>
                  <td><strong>User Email:</strong></td>
                  <td>{{ history.userEmail }} <button class="btn  btn-sm   buttons"  >Send Message</button></td>
                </tr>
                
                <tr>
                  <td><strong>Issuing Admin:</strong></td>
                  <td>{{ history.iAdminName }} ID ({{ history.iAdminId }})</td>
                </tr>
             
                <tr>
                  <td><strong>Receiving Admin:</strong></td>
                  <td *ngIf="history.rAdminName">{{ history.rAdminName }} ID ({{ history.rAdminId }})</td>
                  <td *ngIf="!history.rAdminName">Not Returned Yet</td>
                </tr>
               
                <tr>
                  <td><strong>Book ISBN:</strong></td>
                  <td>{{ history.bookISBN }}</td>
                </tr>
                <tr>
                  <td><strong>Book Genre:</strong></td>
                  <td>{{ history.bookGenre }}</td>
                </tr>
                <tr>
                  <td><strong>Book Copy ID:</strong></td>
                  <td>{{ history.bookCopyId }}</td>
                </tr>
                <tr>
                  <td><strong>Book Condition:</strong></td>
                  <td>{{ history.bookCondition }}</td>
                </tr>
                <tr>
                  <td><strong>Status:</strong></td>
                  <td>{{ history.status }}</td>
                </tr>
              </table>
            </div>
          </td>
        </tr>
      </ng-container>
    </tbody>
  </table>
</div>
