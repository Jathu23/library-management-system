<div class="container">
  <div class="card shadow-lg border-0 rounded-3">
    <div class="card-header bg-primary text-white text-center">
      <h3>Add New Book</h3>
    </div>

    <div class="card-body">
      <form [formGroup]="addBookForm" (ngSubmit)="onSubmit()">
        <div class="row">
          <!-- ISBN -->
          <div class="col-md-6 mb-4">
            <label for="isbn" class="form-label">ISBN</label>
            <div class="input-group">
              <span class="input-group-text bg-secondary text-white">
                <i class="bi bi-upc-scan"></i>
              </span>
              <input type="text" id="isbn" class="form-control" formControlName="ISBN" placeholder="Enter ISBN" />
            </div>
            <div *ngIf="addBookForm.controls['ISBN'].invalid && addBookForm.controls['ISBN'].touched"
              class="text-danger mt-1">
              ISBN is required.
            </div>
          </div>

          <!-- Title -->
          <div class="col-md-6 mb-4">
            <label for="title" class="form-label">Title</label>
            <div class="input-group">
              <span class="input-group-text bg-secondary text-white">
                <i class="bi bi-book"></i>
              </span>
              <input type="text" id="title" class="form-control" formControlName="Title"
                placeholder="Enter Book Title" />
            </div>
            <div *ngIf="addBookForm.controls['Title'].invalid && addBookForm.controls['Title'].touched"
              class="text-danger mt-1">
              Title is required.
            </div>
          </div>
        </div>

        <div class="row">
          <!-- Author -->
          <div class="col-md-6 mb-4">
            <label for="author" class="form-label">Author</label>
            <div class="input-group">
              <span class="input-group-text bg-secondary text-white">
                <i class="bi bi-person"></i>
              </span>
              <input type="text" id="author" class="form-control" formControlName="Author"
                placeholder="Enter Author Name" />
            </div>
            <div *ngIf="addBookForm.controls['Author'].invalid && addBookForm.controls['Author'].touched"
              class="text-danger mt-1">
              Author is required.
            </div>
          </div>

          <!-- Total Copies -->
          <div class="col-md-6 mb-4">
            <label for="totalCopies" class="form-label">Total Copies</label>
            <div class="input-group">
              <span class="input-group-text bg-secondary text-white">
                <i class="bi bi-stack"></i>
              </span>
              <input type="number" id="totalCopies" class="form-control" formControlName="TotalCopies"
                placeholder="Enter Total Copies" />
            </div>
            <div *ngIf="addBookForm.controls['TotalCopies'].invalid && addBookForm.controls['TotalCopies'].touched"
              class="text-danger mt-1">
              Total Copies is required.
            </div>
          </div>

        </div>

        <div class="row">
          <!-- Publish Year -->
          <div class="col-md-6 mb-4">
            <label for="publishYear" class="form-label">Publish Year</label>
            <div class="input-group">
              <span class="input-group-text bg-secondary text-white">
                <i class="bi bi-calendar"></i>
              </span>
              <input type="number" id="publishYear" class="form-control" formControlName="PublishYear"
                placeholder="Enter Publish Year" />
            </div>
            <div *ngIf="addBookForm.controls['PublishYear'].invalid && addBookForm.controls['PublishYear'].touched"
              class="text-danger mt-1">
              Publish Year is required and must be valid.
            </div>
          </div>

          <!-- Shelf Location -->
          <div class="col-md-6 mb-4">
            <label for="shelfLocation" class="form-label">Shelf Location</label>
            <div class="input-group">
              <span class="input-group-text bg-secondary text-white">
                <i class="bi bi-box"></i>
              </span>
              <input type="text" id="shelfLocation" class="form-control" formControlName="ShelfLocation"
                placeholder="Enter Shelf Location" />
            </div>
            <div *ngIf="addBookForm.controls['ShelfLocation'].invalid && addBookForm.controls['ShelfLocation'].touched"
              class="text-danger mt-1">
              Shelf Location is required.
            </div>
          </div>
        </div>

        <div class="row">

          <!-- Genre -->
          <div class="col-md-6 mb-4">
            <label for="genre" class="form-label">Genre</label>
            <div class="input-group">
              <span class="input-group-text bg-secondary text-white">
                <i class="bi bi-tags"></i>
              </span>
              <select id="genre" class="form-select" formControlName="Genre" multiple>
                <option *ngFor="let genre of genresList" [value]="genre">
                  {{ genre }}
                </option>
              </select>
            </div>
            <div *ngIf="addBookForm.controls['Genre'].invalid && addBookForm.controls['Genre'].touched"
              class="text-danger mt-1">
              At least one genre is required.
            </div>
          </div>

          <!-- Cover Images -->
          <div class="col-md-6 mb-4">
            <label for="coverImages" class="form-label">Cover Images</label>
            <div class="input-group">
              <span class="input-group-text bg-secondary text-white">
                <i class="bi bi-image"></i>
              </span>
              <input type="file" id="coverImages" class="form-control" (change)="onFileSelect($event)" multiple />
            </div>
             <!-- Image Previews -->
        <div class="row mt-3">
          <div class="col-md-12 d-flex flex-wrap">
            <div *ngFor="let preview of imagePreviews" class="me-2 mb-2"
              style="border: 1px solid #ddd; padding: 5px; border-radius: 5px;">
              <img [src]="preview" alt="Preview" style="max-width: 100px; max-height: 100px;" />
            </div>
          </div>
        </div>

          </div>
        </div>

       
        <div class="text-center mt-4">
          <button type="submit" class="btn btn-success px-4 py-2" [disabled]="addBookForm.invalid">
            <i class="bi bi-check-circle"></i> Add Book
          </button>
        </div>
      </form>
    </div>
  </div>
</div>


<!-- HTML for book inevntry-->
 
<p class="text-center mt-4">Book Management</p>
<div class="container mt-3">
  <table class="table table-bordered table-hover">
    <thead class="thead-light">
      <tr>
        <th>ID</th>
        <th>ISBN</th>
        <th>Title</th>
        <th>Author</th>
        <th>Genre</th>
        <th>Published Year</th>
        <th>Shelf Location</th>
        <th>Total Copies</th>
        <th>Available Copies</th>
        <th>Image</th>
        <th>Edit</th>
        <th>Delete</th>
        <th>View More</th>
      </tr>
    </thead>
    <tbody>
      <!-- Main rows -->
      <ng-container *ngFor="let book of data">
        <tr>
          <td>{{ book.id }}</td>
          <td>{{ book.isbn }}</td>
          <td>{{ book.title }}</td>
          <td>{{ book.author }}</td>
          <td>{{ book.genre }}</td>
          <td>{{ book.publishYear }}</td>
          <td>{{ book.shelfLocation }}</td>
          <td>{{ book.totalCopies }}</td>
          <td>{{ book.availableCopies }}</td>
          <td>
            <img src="book.image" alt="Book Image" class="img-thumbnail" style="width: 50px; height: 50px;" />
          </td>
          <td>
            <button class="btn btn-sm btn-primary">Edit</button>
          </td>
          <td>
            <button class="btn btn-sm btn-danger">Delete</button>
          </td>
          <td>
            <a *ngIf="book.toggle === 0" (click)="book.toggle = 1">
              <button class="btn btn-sm btn-success">+</button>
            </a>
            <a *ngIf="book.toggle === 1" (click)="book.toggle = 0">
              <button class="btn btn-sm btn-warning">-</button>
            </a>
          </td>
        </tr>

        <!-- Nested rows -->
        <ng-container *ngIf="book.toggle === 1">
          <tr class="bg-light">
            <td colspan="13">
              <table class="table table-sm table-bordered">
                <thead class="thead-dark">
                  <tr>
                    <th>Copy ID</th>
                    <th>Condition</th>
                    <th>Is Available</th>
                    <th>Last Borrowed Date</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let nestedRow of book.bookCopies">
                    <td>{{ nestedRow.copyId }}</td>
                    <td>{{ nestedRow.condition }}</td>
                    <td>{{ nestedRow.isAvailable ? 'Yes' : 'No' }}</td>
                    <td>null</td>
                  </tr>
                </tbody>
              </table>
            </td>
          </tr>
        </ng-container>
      </ng-container>
    </tbody>
  </table>
</div>


